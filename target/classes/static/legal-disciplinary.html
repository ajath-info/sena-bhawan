<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Add Personnel - Complete Profile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* ===== existing styles untouched ===== */
        *{margin:0;padding:0;box-sizing:border-box}
        html,body{height:100%;overflow:hidden}
        body{font-family:"Inter",sans-serif;background:#f1f3f5;color:#1f2937}
        .container{display:flex;height:100vh}
        .sidebar{width:256px;background:linear-gradient(180deg,#1b4332,#081c15);color:white;display:flex;flex-direction:column}
        .sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.1)}
        .logo-section{display:flex;gap:12px;align-items:center}
        .logo-icon{width:32px;height:32px;background:#ffb703;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700}
        .logo-text h1{font-size:18px}
        .logo-text p{font-size:11px;color:#52b788}
        .sidebar-nav{padding:16px 0;flex:1}
        .nav-section-title{padding:14px 20px 8px;font-size:11px;font-weight:700;color:#52b788;text-transform:uppercase}
        .nav-item{padding:12px 20px;display:flex;gap:12px;color:white;text-decoration:none}
        .nav-item.active{background:rgba(255,255,255,.1);border-left:4px solid #ffb703}
        .sidebar-footer{padding:16px;border-top:1px solid rgba(255,255,255,.1)}
        .user-profile{display:flex;gap:12px;align-items:center}
        .user-avatar{width:36px;height:36px;border-radius:50%;background:#2d6a4f;display:flex;align-items:center;justify-content:center;font-weight:700}

        .main-content{flex:1;display:flex;flex-direction:column}
        .header{background:white;border-bottom:1px solid #e5e7eb;padding:16px 24px}
        .header h2{font-size:22px;font-weight:700}
        .header p{font-size:13px;color:#6b7280}
        .content-area{flex:1;overflow-y:auto;padding:24px}

        .form-card{max-width:900px;margin:auto;background:white;border-radius:12px;border:1px solid #e5e7eb;padding:24px}
        .form-title{font-size:16px;font-weight:700}
        .form-subtitle{font-size:13px;color:#6b7280;margin-bottom:20px}
        .section{margin-top:22px}
        .section-title{font-size:14px;font-weight:700;margin-bottom:12px;display:flex;gap:8px;align-items:center}

        .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
        .grid-1{grid-template-columns:1fr}
        label{font-size:13px;font-weight:600;margin-bottom:6px;display:block}
        input,select,textarea{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #d1d5db;font-size:14px}
        textarea{min-height:90px;resize:vertical}

        .note-box{background:#fef3c7;color:#92400e;padding:12px 14px;border-radius:8px;font-size:13px;margin-bottom:16px}

        .table{width:100%;border-collapse:collapse;font-size:13px}
        .table th{padding:10px;color:#6b7280;border-bottom:1px solid #e5e7eb;text-align:left}
        .table td{padding:10px;border-bottom:1px solid #e5e7eb}

        .badge{background:#dcfce7;color:#166534;padding:3px 8px;border-radius:999px;font-size:12px;font-weight:600}

        .btn{padding:10px 16px;border-radius:8px;font-weight:600;font-size:13px;cursor:pointer}
        .btn-primary{background:#1b4332;color:white;border:none}
        .btn-secondary{background:white;border:1px solid #d1d5db}
        .actions{display:flex;justify-content:flex-end;gap:12px;margin-top:20px}
    </style>
</head>

<body>
<script src="auth.js"></script>
<script src="logout.js"></script>

<div class="container">

    <!-- SIDEBAR -->
<!--    <aside class="sidebar">-->
<!--        <div class="sidebar-header">-->
<!--            <div class="logo-section">-->
<!--                <div class="logo-icon">ğŸ›¡ï¸</div>-->
<!--                <div class="logo-text">-->
<!--                    <h1>ARMY HRMS</h1>-->
<!--                    <p>à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤¸à¥‡à¤¨à¤¾</p>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--        <nav class="sidebar-nav">-->
<!--            <div class="nav-section-title">Main Menu</div>-->

<!--            <a href="/dashboard-new.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ </div>-->
<!--                <span>Dashboard</span>-->
<!--            </a>-->

<!--            <a href="/dashboard-officers.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ </div>-->
<!--                <span>Dashboard Officers</span>-->
<!--            </a>-->

<!--            <a href="/dashboard-training.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ </div>-->
<!--                <span>Dashboard Training</span>-->
<!--            </a>-->

<!--            <a href="/filter.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ”</div>-->
<!--                <span>Master Filter & Search</span>-->
<!--            </a>-->

<!--            <div class="nav-section-title">Administration</div>-->

<!--            <a href="/role-permmissoon.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ”</div>-->
<!--                <span>Role & Permissions</span>-->
<!--            </a>-->

<!--            &lt;!&ndash; <a href="/user-management.html" class="nav-item">-->
<!--              <div class="nav-icon">ğŸ‘¥</div>-->
<!--              <span>User Management</span>-->
<!--            </a> &ndash;&gt;-->

<!--            <div class="nav-section-title">Masters</div>-->

<!--            <a href="/course-master.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ“š</div>-->
<!--                <span>Course Master</span>-->
<!--            </a>-->

<!--            <a href="/grade-awards.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ“</div>-->
<!--                <span>Grade & Awards</span>-->
<!--            </a>-->

<!--            <a href="/course-schedule.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ“…</div>-->
<!--                <span>Course Schedule</span>-->
<!--            </a>-->

<!--            <a href="/location-master.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ“</div>-->
<!--                <span>Location Master</span>-->
<!--            </a>-->

<!--            &lt;!&ndash; <a href="/command-master.html" class="nav-item">-->
<!--              <div class="nav-icon">ğŸš©</div>-->
<!--              <span>Command Master</span>-->
<!--            </a> &ndash;&gt;-->

<!--            <a href="/rank-master.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ…</div>-->
<!--                <span>Rank Master</span>-->
<!--            </a>-->

<!--            <a href="/unit-master.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ›¡ï¸</div>-->
<!--                <span>Unit Master</span>-->
<!--            </a>-->

<!--            <div class="nav-section-title">Forms</div>-->

<!--            <a href="/personnel-form.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ‘¤</div>-->
<!--                <span>Personnel Data Form</span>-->
<!--            </a>-->

<!--            <a href="/coursepanel.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ“‹</div>-->
<!--                <span>Course Panel Generation</span>-->
<!--            </a>-->

<!--            <a href="/orbat.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ“‹</div>-->
<!--                <span>Orbit Generation Form</span>-->
<!--            </a>-->

<!--            <a href="/add-new-user.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ“‹</div>-->
<!--                <span>New User Form</span>-->
<!--            </a>-->

<!--            <a href="/legal-disciplinary.html" class="nav-item active">-->
<!--                <div class="nav-icon">ğŸ“‹</div>-->
<!--                <span>Legal And Disciplinary Form</span>-->
<!--            </a>-->

<!--            <a href="/course-posting-form.html" class="nav-item">-->
<!--                <div class="nav-icon">ğŸ“</div>-->
<!--                <span>Course & Posting Form</span>-->
<!--            </a>-->
<!--        </nav>-->

<!--        <div class="sidebar-footer">-->
<!--            <div class="user-profile">-->
<!--                <div class="user-avatar">AD</div>-->
<!--                <div class="user-info">-->
<!--                    <div class="name">Admin User</div>-->
<!--                    <div class="role">HQ Command</div>-->
<!--                </div>-->
<!--                <div>ğŸšª</div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </aside>-->

    <div id="sidebar"></div>

    <!-- MAIN -->
    <main class="main-content">
        <div class="header">
            <h2>Add Personnel â€“ Complete Profile</h2>
            <p>Fill all required fields including legal / disciplinary details</p>
        </div>

        <div class="content-area">
            <div class="form-card">

                <div class="form-title">Personnel Information Form</div>
                <div class="form-subtitle">Complete officer profile with all details</div>

                <!-- BASIC -->
                <div class="section">
                    <div class="section-title">ğŸ“‹ Basic Information</div>
                    <div class="grid">
                        <div>
                            <label>Army No *</label>
                            <select id="armySelect">
                                <option value="">Select Army No</option>
                            </select>
                        </div>
                        <div>
                            <label>Rank *</label>
                            <input id="rankInput" readonly>
                        </div>
                        <div class="grid-1">
                            <label>Full Name *</label>
                            <input id="fullNameInput" readonly>
                        </div>
                    </div>
                </div>

                <!-- LEGAL -->
                <div class="section">
                    <div class="section-title">âš–ï¸ Legal / Disciplinary Details</div>
                    <div class="note-box">
                        Record any legal cases, court of inquiry, or disciplinary actions.
                    </div>

                    <div class="grid">

                        <div>
                            <label>Case Id</label>
                            <input id="caseId">
                        </div>
                        <div>
                            <label>Case Type</label>
                            <input id="caseType">
                        </div>
                        <div>
                            <label>Current Status</label>
                            <input id="currentStatus">
                        </div>
                        <div>
                            <label>Date of Initiation / Filing</label>
                            <input id="dateOfFiling" type="date">
                        </div>
                    </div>

                    <div class="grid grid-1" style="margin-top:12px">
                        <div>
                            <label>Final Outcome / Present Stage</label>
                            <textarea id="finalOutcome"></textarea>
                        </div>
                    </div>
                </div>

                <!-- PREVIOUS -->
                <div class="section">
                    <div class="section-title">ğŸ“œ Previous Legal / Disciplinary Records</div>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Case Id</th>
                            <th>Case Type</th>
                            <th>Date Filed</th>
                            <th>Status</th>
                            <th>Outcome</th>
                        </tr>
                        </thead>
                        <tbody id="recordsBody"></tbody>
                    </table>
                </div>

                <div class="actions">
                    <button class="btn btn-secondary">Cancel</button>
                    <button class="btn btn-primary" id="saveBtn">Save Personnel</button>
                </div>

            </div>
        </div>
    </main>
</div>

<script>
    const PERSONNEL_API = "http://localhost:6060/api/personnel";
    const SAVE_API = "http://localhost:6060/api/personnelinformation";
    const GET_INFO_API = "http://localhost:6060/api/personnelinformation";

    let personnelList = [];
    let selectedPersonnelId = null;

    /* Load Army Numbers */
    fetch(PERSONNEL_API)
      .then(r => r.json())
      .then(data => {
        personnelList = data;
        const select = document.getElementById("armySelect");
        data.forEach(p => {
          const opt = document.createElement("option");
          opt.value = p.id;
          opt.textContent = p.armyNo;
          select.appendChild(opt);
        });
      });

    /* On Army Select */
    document.getElementById("armySelect").addEventListener("change", e => {
      const id = e.target.value;
      if (!id) return;

      const p = personnelList.find(x => x.id == id);
      selectedPersonnelId = p.id;

      document.getElementById("rankInput").value = p.rank;
      document.getElementById("fullNameInput").value = p.fullName;

      loadRecords(id);
    });

    /* Load previous records */
    function loadRecords(id) {
      fetch(`${GET_INFO_API}/${id}`)
        .then(r => r.json())
        .then(data => {
          const tbody = document.getElementById("recordsBody");
          tbody.innerHTML = "";
          data.forEach((x, i) => {
            tbody.innerHTML += `
              <tr>
                <td>${i + 1}</td>
                 <td>${x.caseId}</td>
                <td>${x.caseType}</td>
                <td>${x.dateOfFiling}</td>
                <td><span class="badge">${x.currentStatus}</span></td>
                <td>${x.finalOutcome}</td>
              </tr>`;
          });
        });
    }

    /* Save */
    document.getElementById("saveBtn").onclick = () => {
      if (!selectedPersonnelId) {
        alert("Select Army No first");
        return;
      }

      const payload = {
        personnelId: selectedPersonnelId,
        rank: document.getElementById("rankInput").value,
        fullName: document.getElementById("fullNameInput").value,
        caseType: document.getElementById("caseType").value,
          caseId: document.getElementById("caseId").value,
        dateOfFiling: document.getElementById("dateOfFiling").value,
        currentStatus: document.getElementById("currentStatus").value,
        finalOutcome: document.getElementById("finalOutcome").value
      };

      fetch(SAVE_API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      }).then(r => {
        if (r.ok) {
          alert("Saved successfully");
          loadRecords(selectedPersonnelId);
        } else {
          alert("Save failed");
        }
      });
    };
</script>
</body>
</html>