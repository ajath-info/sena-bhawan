<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Course Remarks Update</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
          font-family: "Inter", sans-serif;
          background:#f1f3f5;
          margin:0;
        }

        .container {
          display:flex;
          height:100vh;
        }

        /* Sidebar */
        .sidebar {
          width:256px;
          background:linear-gradient(180deg,#1b4332 0%,#081c15 100%);
          color:white;
          padding:20px;
        }

        .nav-item {
          display:block;
          padding:10px 0;
          color:white;
          text-decoration:none;
        }

        .nav-item.active {
          font-weight:700;
        }

        /* Main */
        .main-content {
          flex:1;
          display:flex;
          flex-direction:column;
        }

        .header {
          background:white;
          padding:20px;
          border-bottom:1px solid #ddd;
        }

        .content-area {
          flex:1;
          overflow-y:auto;
          padding:24px;
        }

        /* Card */
        .form-card {
          max-width:900px;
          margin:auto;
          background:white;
          padding:25px;
          border-radius:10px;
          box-shadow:0 10px 25px rgba(0,0,0,0.08);
        }

        .section {
          border:1px solid #ddd;
          border-radius:8px;
          padding:15px;
          margin-bottom:20px;
        }

        .section-title {
          font-weight:600;
          margin-bottom:12px;
          border-bottom:1px solid #ccc;
          padding-bottom:5px;
        }

        textarea {
          width:100%;
          padding:8px;
          border-radius:5px;
          border:1px solid #ccc;
          min-height:70px;
        }

        .radio-group {
          display:flex;
          gap:20px;
        }

        .btn-primary {
          background:#1b4332;
          color:white;
          border:none;
          padding:10px 20px;
          border-radius:6px;
          cursor:pointer;
        }
    </style>
</head>

<body>

<div class="container">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-section">
                <div class="logo-icon">üõ°Ô∏è</div>
                <div class="logo-text">
                    <h1>ARMY HRMS</h1>
                    <p>‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§∏‡•á‡§®‡§æ</p>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="/dashboard-new.html" class="nav-item">üè† Dashboard</a>
            <a href="/personnel-form.html" class="nav-item">üë§ Personnel Data</a>
            <a href="/coursepanel.html" class="nav-item">üìã Course Panel</a>
            <a href="/remarks.html" class="nav-item">üìã Course Remarks Update</a>
        </nav>
    </aside>

    <!-- MAIN -->
    <main class="main-content">

        <div class="content-area">

            <div class="form-card">

                <div class="header">
                    <h2>Course Remarks Update</h2>
                    <p>Update remarks before and after course detailment</p>
                </div>

                <!-- SELECT PERSONNEL -->
                <div class="section">
                    <div class="section-title">Select Personnel</div>
                    <select id="personnelSelect">
                        <option>Select Personnel</option>
                    </select>
                </div>

                <!-- BEFORE DETAILMENT -->
                <div class="section">
                    <div class="section-title">Before Detailment</div>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="before" value="Volunteer">
                            Volunteer
                        </label>
                        <label>
                            <input type="radio" name="before" value="NotDetail">
                            Not to Detail
                        </label>
                    </div>

                    <div id="notDetailReason" style="display:none;margin-top:10px;">
                        <textarea id="beforeReason" placeholder="Reason for not detailing"></textarea>
                    </div>
                </div>


                <!-- AFTER DETAILMENT -->
                <div class="section">
                    <div class="section-title">After Detailment</div>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="after" value="TakenOff" >
                            Taken Off
                        </label>
                        <label>
                            <input type="radio" name="after" value="Continuing" >
                            Continuing
                        </label>
                    </div>

                    <div id="takenOffReason" style="display:none;margin-top:10px;">
                        <textarea id="afterReason" placeholder="Reason for taken off"></textarea>
                    </div>
                </div>


                <!-- GENERAL REMARK -->
                <div class="section">
                    <div class="section-title">General Remarks</div>
                    <textarea id="generalRemarks" placeholder="General remarks"></textarea>
                </div>

                <div style="text-align:right;">
                    <button class="btn-primary" onclick="saveRemarks()">Update Remarks</button>
                </div>

            </div>

        </div>
    </main>
</div>


<script>

    const PERSONNEL_API = "http://localhost:6060/api/personnel";
    const personnelSelect = document.getElementById("personnelSelect");

    let personnelList = [];

    /* Load personnel */
    fetch(PERSONNEL_API)
      .then(res => res.json())
      .then(data => {
          personnelList = data;

          data.forEach(p => {
              const option = document.createElement("option");
              option.value = p.id; // personnel ID
              option.textContent = `${p.fullName} (${p.armyNo})`;
              personnelSelect.appendChild(option);
          });
      })
      .catch(err => {
          console.error("Failed to load personnel", err);
      });

    /* When personnel selected */
    personnelSelect.addEventListener("change", function () {
        const selectedId = this.value;
        if (!selectedId) return;

        const selectedPerson = personnelList.find(p => p.id == selectedId);
        console.log("Selected Personnel:", selectedPerson);
    });

    const REMARKS_API = "http://localhost:6060/api/remarks/save";


/* save data  */

function saveRemarks() {

    const personnelId = document.getElementById("personnelSelect").value;

    if (!personnelId || personnelId === "" || personnelId === null ) {
        alert("Please select personnel");
        return;
    }
    const beforeRadio = document.querySelector('input[name="before"]:checked');
if (beforeRadio === null) {
    alert("Please select Before Detailment");
    return;
}

const afterRadio = document.querySelector('input[name="after"]:checked');
if (afterRadio === null) {
    alert("Please select After Detailment");
    return;
}


    /* GENERAL REMARKS */
const generalRemarks = document.getElementById("generalRemarks").value.trim();

    const payload = {
        personnelId: Number(personnelId),
        beforeDetailment: beforeRadio.value,
        afterDetailment: afterRadio.value,
        generalRemarks: generalRemarks
    };

    console.log("Sending:", payload);

    fetch(REMARKS_API, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
    })
    .then(res => {
        if (!res.ok) throw new Error("Save failed");
        return res.json();
    })
    .then(data => {
        alert("Remarks updated successfully ‚úÖ");
        console.log("Saved:", data);
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Error saving remarks ‚ùå");
    });
}


</script>


</body>
</html>
