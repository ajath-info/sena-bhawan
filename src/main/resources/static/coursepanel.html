<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Course Panel Generation - ARMY HRMS</title>
    <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
        body {
          font-family: "Inter", sans-serif;
          background: #f1f3f5;
          color: #1f2937;
        }
        .nav-item {
          text-decoration: none;
          color: white;
        }
        .container {
          display: flex;
          height: 100vh;
        }

        .sidebar {
          width: 256px;
          background: linear-gradient(180deg, #1b4332 0%, #081c15 100%);
          color: white;
          display: flex;
          flex-direction: column;
        }
        .sidebar-header {
          padding: 20px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          display: flex;
          align-items: center;
          justify-content: space-between;
          min-height: 72px;
        }
        .logo-section {
          display: flex;
          align-items: center;
          gap: 12px;
        }
        .logo-icon {
          width: 32px;
          height: 32px;
          background: #ffb703;
          border-radius: 6px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          font-size: 16px;
        }
        .logo-text h1 {
          font-size: 18px;
          font-weight: 700;
        }
        .logo-text p {
          font-size: 11px;
          color: #52b788;
        }
        .menu-icon {
          width: 24px;
          height: 24px;
          display: flex;
          flex-direction: column;
          gap: 4px;
        }
        .menu-icon span {
          width: 100%;
          height: 2px;
          background: white;
          border-radius: 2px;
        }
        .sidebar-nav {
          flex: 1;
          overflow-y: auto;
          padding: 16px 0;
        }
        .nav-section-title {
          padding: 16px 20px 8px;
          font-size: 11px;
          font-weight: 700;
          text-transform: uppercase;
          color: #52b788;
        }
        .nav-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 12px 20px;
          color: white;
          border-left: 4px solid transparent;
        }
        .nav-item.active {
          background: rgba(255, 255, 255, 0.1);
          border-left-color: #ffb703;
          font-weight: 600;
        }
        .nav-icon {
          width: 20px;
          height: 20px;
          font-size: 18px;
        }
        .sidebar-footer {
          padding: 16px;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .user-profile {
          display: flex;
          align-items: center;
          gap: 12px;
        }
        .user-avatar {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background: #2d6a4f;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 700;
          font-size: 14px;
        }
        .user-info {
          flex: 1;
        }
        .user-info .name {
          font-size: 14px;
          font-weight: 600;
        }
        .user-info .role {
          font-size: 12px;
          color: #52b788;
        }

        .main-content {
          flex: 1;
          display: flex;
          flex-direction: column;
        }
        .header {
          background: white;
          border-bottom: 1px solid #e5e7eb;
          padding: 16px 24px;
          display: flex;
          align-items: center;
          justify-content: space-between;
          min-height: 72px;
        }
        .header-left h2 {
          font-size: 24px;
          font-weight: 700;
          margin-bottom: 4px;
        }
        .header-left p {
          font-size: 14px;
          color: #6b7280;
        }

        .content-area {
          flex: 1;
          overflow-y: auto;
          padding: 24px;
        }
        .form-container {
          max-width: 1400px;
          margin: 0 auto;
        }

        .step-indicator {
          display: flex;
          justify-content: space-between;
          margin-bottom: 32px;
          background: white;
          padding: 24px;
          border-radius: 12px;
          border: 1px solid #e5e7eb;
        }
        .step {
          flex: 1;
          display: flex;
          align-items: center;
          gap: 12px;
          position: relative;
        }
        .step::after {
          content: "";
          position: absolute;
          left: 100%;
          top: 20px;
          width: 100%;
          height: 2px;
          background: #e5e7eb;
          z-index: 0;
        }
        .step:last-child::after {
          display: none;
        }
        .step.active .step-number {
          background: #1b4332;
          color: white;
        }
        .step.active .step-label {
          color: #1b4332;
          font-weight: 700;
        }
        .step.completed .step-number {
          background: #10b981;
          color: white;
        }
        .step.completed::after {
          background: #10b981;
        }
        .step-number {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background: #e5e7eb;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 700;
          color: #6b7280;
          z-index: 1;
          position: relative;
        }
        .step-content {
        }
        .step-label {
          font-size: 14px;
          font-weight: 600;
          color: #6b7280;
        }
        .step-desc {
          font-size: 12px;
          color: #9ca3af;
        }

        .section-card {
          background: white;
          border: 1px solid #e5e7eb;
          border-radius: 12px;
          padding: 24px;
          margin-bottom: 20px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .section-title {
          font-size: 18px;
          font-weight: 700;
          color: #1f2937;
          margin-bottom: 16px;
          padding-bottom: 12px;
          border-bottom: 2px solid #e5e7eb;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .form-grid {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 20px;
        }
        .form-group {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }
        .form-group.full-width {
          grid-column: 1 / -1;
        }
        .form-label {
          font-size: 14px;
          font-weight: 600;
          color: #374151;
        }
        .form-label .required {
          color: #ef4444;
        }
        .form-input,
        .form-select {
          padding: 12px 16px;
          border: 1px solid #d1d5db;
          border-radius: 8px;
          font-size: 14px;
          background: white;
        }

        .strength-control {
          display: flex;
          align-items: center;
          gap: 16px;
          background: #f9fafb;
          padding: 20px;
          border-radius: 12px;
          border: 2px solid #e5e7eb;
        }
        .strength-label {
          font-size: 14px;
          font-weight: 600;
          color: #374151;
          flex: 1;
        }
        .strength-buttons {
          display: flex;
          gap: 12px;
          align-items: center;
        }
        .strength-btn {
          width: 40px;
          height: 40px;
          border-radius: 8px;
          border: none;
          background: #1b4332;
          color: white;
          font-size: 20px;
          font-weight: 700;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .strength-btn:hover {
          background: #081c15;
        }
        .strength-value {
          font-size: 32px;
          font-weight: 700;
          color: #1b4332;
          min-width: 80px;
          text-align: center;
        }

        .info-box {
          background: #eff6ff;
          border-left: 4px solid #3b82f6;
          padding: 16px;
          border-radius: 8px;
          margin: 16px 0;
        }
        .info-box strong {
          color: #1e40af;
        }
        .info-box p {
          font-size: 14px;
          color: #1e3a8a;
          line-height: 1.6;
        }

        .filter-chips {
          display: flex;
          flex-wrap: wrap;
          gap: 12px;
          margin-top: 16px;
        }
        .filter-chip {
          display: inline-flex;
          align-items: center;
          gap: 8px;
          padding: 8px 16px;
          background: white;
          border: 2px solid #1b4332;
          border-radius: 20px;
          font-size: 13px;
          font-weight: 600;
          color: #1b4332;
          cursor: pointer;
        }
        .filter-chip.active {
          background: #1b4332;
          color: white;
        }
        .filter-chip:hover {
          background: #f0fdf4;
        }

        .data-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 16px;
        }
        .data-table thead {
          background: #f9fafb;
        }
        .data-table th {
          padding: 12px;
          text-align: left;
          font-size: 11px;
          font-weight: 700;
          text-transform: uppercase;
          color: #6b7280;
          border-bottom: 2px solid #e5e7eb;
        }
        .data-table td {
          padding: 14px 12px;
          border-bottom: 1px solid #f3f4f6;
          font-size: 14px;
        }
        .data-table tbody tr:hover {
          background: #f9fafb;
        }
        .data-table tbody tr:last-child td {
          border-bottom: none;
        }

        .checkbox {
          width: 20px;
          height: 20px;
          border: 2px solid #d1d5db;
          border-radius: 4px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .checkbox.checked {
          background: #1b4332;
          border-color: #1b4332;
          color: white;
          font-weight: 700;
        }

        .ser-no {
          font-weight: 700;
          color: #1b4332;
        }
        .officer-name {
          font-weight: 600;
          color: #1f2937;
        }
        .officer-army-no {
          font-size: 12px;
          color: #6b7280;
        }

        .badge {
          display: inline-block;
          padding: 4px 10px;
          border-radius: 12px;
          font-size: 11px;
          font-weight: 600;
        }
        .badge-success {
          background: #d1fae5;
          color: #10b981;
        }
        .badge-warning {
          background: #fef3c7;
          color: #f59e0b;
        }
        .badge-info {
          background: #dbeafe;
          color: #3b82f6;
        }
        .badge-danger {
          background: #fee2e2;
          color: #ef4444;
        }

        .attendance-toggle {
          display: flex;
          gap: 8px;
        }
        .attendance-btn {
          padding: 6px 12px;
          border-radius: 6px;
          border: 2px solid #d1d5db;
          background: white;
          font-size: 12px;
          font-weight: 600;
          cursor: pointer;
        }
        .attendance-btn.attending {
          border-color: #10b981;
          background: #d1fae5;
          color: #10b981;
        }
        .attendance-btn.not-attending {
          border-color: #ef4444;
          background: #fee2e2;
          color: #ef4444;
        }

        .btn {
          padding: 12px 24px;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 600;
          border: none;
          cursor: pointer;
          display: inline-flex;
          align-items: center;
          gap: 8px;
        }
        .btn-primary {
          background: #1b4332;
          color: white;
        }
        .btn-secondary {
          background: white;
          color: #1b4332;
          border: 2px solid #1b4332;
        }
        .btn-success {
          background: #10b981;
          color: white;
        }

        .summary-box {
          background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
          border: 2px solid #86efac;
          border-radius: 12px;
          padding: 24px;
        }
        .summary-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 20px;
          margin-top: 16px;
        }
        .summary-item {
          text-align: center;
        }
        .summary-value {
          font-size: 32px;
          font-weight: 700;
          color: #065f46;
        }
        .summary-label {
          font-size: 13px;
          color: #047857;
          margin-top: 4px;
        }
          .step-section {
    display: none;
  }

  .step-section.active {
    display: block;
  }
  .step-nav {
    display: flex;
    justify-content: flex-end;
    gap: 24px;
    margin-top: 32px;
  }

  .step-nav-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    user-select: none;
  }

  .step-nav-btn .step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #6b7280;
  }

  .step-nav-btn .step-label {
    font-size: 14px;
    font-weight: 600;
    color: #6b7280;
  }

  .step-nav-btn .step-desc {
    font-size: 12px;
    color: #9ca3af;
  }

  /* ACTIVE STATE (same as top active step) */
  .step-nav-btn.active .step-number {
    background: #1b4332;
    color: white;
  }

  .step-nav-btn.active .step-label {
    color: #1b4332;
    font-weight: 700;
  }

  /* DISABLED */
  .step-nav-btn.disabled {
    opacity: 0.4;
    pointer-events: none;
  }
  /* ===== FOOTER NAVIGATION ===== */

  .footer-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #e5e7eb;
  }

  .footer-left,
  .footer-right {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  /* Step-style buttons (Previous / Next) */
  .step-nav-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    user-select: none;
  }

  .step-nav-btn .step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #6b7280;
  }

  .step-nav-btn .step-label {
    font-size: 14px;
    font-weight: 600;
    color: #6b7280;
  }

  .step-nav-btn .step-desc {
    font-size: 12px;
    color: #9ca3af;
  }

  /* Active */
  .step-nav-btn.active .step-number {
    background: #1b4332;
    color: white;
  }

  .step-nav-btn.active .step-label {
    color: #1b4332;
    font-weight: 700;
  }

  /* Disabled */
  .step-nav-btn.disabled {
    opacity: 0.4;
    pointer-events: none;
  }

  /* Draft / Approval buttons */
  .footer-btn {
    padding: 10px 18px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    border: none;
    cursor: pointer;
  }

  .footer-btn.secondary {
    background: white;
    border: 2px solid #1b4332;
    color: #1b4332;
  }

  .footer-btn.success {
    background: #10b981;
    color: white;
  }

		/* ===== FILTER GRID (4 COLUMNS) ===== */
.filter-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px 8px;
}

/* Checkbox groups */
.filter-options {
  display: flex;
  flex-wrap: wrap;
  gap: 10px 12px;
}

.filter-options label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
}

/* Make inputs consistent */
.filter-grid .form-input,
.filter-grid .form-select {
  height: 44px;
}

/* Full-width row */
.filter-full {
  grid-column: 1 / -1;
}

/* Responsive */
@media (max-width: 1200px) {
  .filter-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 640px) {
  .filter-grid {
    grid-template-columns: 1fr;
  }
}

.filter-actions {
  grid-column: 1 / -1;
  display: flex;
  justify-content: flex-start; /* or flex-end */
}

.filter-actions button {
  width: fit-content !important;
  min-width: unset !important;
  padding: 8px 18px !important;
  font-size: 14px !important;
  border-radius: 8px;
}
		/* ===== SCROLLABLE DATA TABLE ===== */

/* Outer wrapper: controls scroll */
.table-scroll-wrapper {
  max-height: 420px;          /* vertical scroll height */
  overflow-y: auto;
  overflow-x: auto;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  background: white;
}

/* Keep header visible while scrolling */
.table-scroll-wrapper thead th {
  position: sticky;
  top: 0;
  background: #f9fafb;
  z-index: 2;
  border-bottom: 2px solid #e5e7eb;
}

/* Prevent columns from shrinking */
.data-table {
  min-width: 1400px; /* adjust if you add more columns */
}

/* Long text cells (medical remarks etc.) */
.data-table td {
  vertical-align: top;
}

/* Optional: smoother scroll */
.table-scroll-wrapper::-webkit-scrollbar {
  height: 10px;
  width: 10px;
}
.table-scroll-wrapper::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 8px;
}
.data-table td:nth-child(13) {
  max-width: 260px;
  white-space: pre-line;
}
		.form-textarea {
  width: 100%;
  min-height: 96px;
  padding: 12px 16px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  font-size: 14px;
  font-family: "Inter", sans-serif;
  color: #1f2937;
  background: white;
  resize: vertical;          /* allow up/down resize only */
  line-height: 1.5;
}

.form-textarea:focus {
  outline: none;
  border-color: #1b4332;
  box-shadow: 0 0 0 2px rgba(27, 67, 50, 0.15);
}

.form-textarea::placeholder {
  color: #9ca3af;
}

    </style>
</head>
<body>
<div class="container">
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-section">
                <div class="logo-icon">üõ°Ô∏è</div>
                <div class="logo-text">
                    <h1>ARMY HRMS</h1>
                    <p>‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§∏‡•á‡§®‡§æ</p>
                </div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section-title">Main Menu</div>

            <a href="/dashboard-new.html" class="nav-item">
                <div class="nav-icon">üè†</div>
                <span>Dashboard</span>
            </a>

            <a href="/dashboard-officers.html" class="nav-item">
                <div class="nav-icon">üè†</div>
                <span>Dashboard Officers</span>
            </a>

            <a href="/dashboard-training.html" class="nav-item">
                <div class="nav-icon">üè†</div>
                <span>Dashboard Training</span>
            </a>

            <a href="/filter.html" class="nav-item">
                <div class="nav-icon">üîç</div>
                <span>Master Filter & Search</span>
            </a>

            <div class="nav-section-title">Administration</div>

            <a href="/role-permmissoon.html" class="nav-item">
                <div class="nav-icon">üîê</div>
                <span>Role & Permissions</span>
            </a>

            <!-- <a href="/user-management.html" class="nav-item">
              <div class="nav-icon">üë•</div>
              <span>User Management</span>
            </a> -->

            <div class="nav-section-title">Masters</div>

            <a href="/course-master.html" class="nav-item">
                <div class="nav-icon">üìö</div>
                <span>Course Master</span>
            </a>

            <a href="/grade-awards.html" class="nav-item">
                <div class="nav-icon">üìù</div>
                <span>Grade & Awards</span>
            </a>

            <a href="/course-schedule.html" class="nav-item">
                <div class="nav-icon">üìÖ</div>
                <span>Course Schedule</span>
            </a>

            <a href="/location-master.html" class="nav-item">
                <div class="nav-icon">üìç</div>
                <span>Location Master</span>
            </a>

            <!-- <a href="/command-master.html" class="nav-item">
              <div class="nav-icon">üö©</div>
              <span>Command Master</span>
            </a> -->

            <a href="/rank-master.html" class="nav-item">
                <div class="nav-icon">üèÖ</div>
                <span>Rank Master</span>
            </a>

            <a href="/unit-master.html" class="nav-item">
                <div class="nav-icon">üõ°Ô∏è</div>
                <span>Unit Master</span>
            </a>

            <div class="nav-section-title">Forms</div>

            <a href="/personnel-form.html" class="nav-item">
                <div class="nav-icon">üë§</div>
                <span>Personnel Data Form</span>
            </a>

            <a href="/coursepanel.html" class="nav-item active">
                <div class="nav-icon">üìã</div>
                <span>Course Panel Generation</span>
            </a>

            <a href="/course-posting-form.html" class="nav-item">
                <div class="nav-icon">üìù</div>
                <span>Course & Posting Form</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">AD</div>
                <div class="user-info">
                    <div class="name">Admin User</div>
                    <div class="role">HQ Command</div>
                </div>
                <div>üö™</div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <header class="header">
            <div class="header-left">
                <h2>Course Panel Generation</h2>
                <p>Generate and manage course nomination panels</p>
            </div>
        </header>

        <div class="content-area">
            <div class="form-container">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step">
                        <div class="step-number">‚úì</div>
                        <div class="step-content">
                            <div class="step-label">Course Selection</div>
                            <div class="step-desc">Select course</div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">‚úì</div>
                        <div class="step-content">
                            <div class="step-label">Define Strength</div>
                            <div class="step-desc">Set panel size</div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-label">Apply Filters</div>
                            <div class="step-desc">Select officers</div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-label">Review & Approve</div>
                            <div class="step-desc">Final approval</div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <div class="step-label">Generate Letter</div>
                            <div class="step-desc">Course letter</div>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Course Selection -->
                <div class="section-card step-section active" id="step-1">
                    <div class="section-title">
                        <span>üìö Step 1: Course Selection</span>
                    </div>

                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label class="form-label">
                                Selected Course <span class="required">*</span>
                            </label>

                            <select class="form-select" id="courseSelect">
                                <option value="">-- Select Course --</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Course Start Date</label>
                            <input type="date" id="courseStartDate" class="form-input" readonly />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Course End Date</label>
                            <input type="date" id="courseEndDate" class="form-input" readonly />
                        </div>
                    </div>
                </div>

                <!-- Step 2: Define Strength -->
                <div class="section-card step-section" id="step-2">
                    <div class="section-title">
                        <span>‚ûï Step 2: Define Panel Strength</span>
                        <span class="badge badge-success">Completed</span>
                    </div>

                    <!-- Course Strength (READ ONLY) -->
                    <div class="strength-control">
                        <div class="strength-label">
                            <div style="font-size:16px;font-weight:700;margin-bottom:4px;">
                                Course Strength
                            </div>
                            <div style="font-size:13px;color:#6b7280">
                                Total seats available for this course
                            </div>
                        </div>

                        <div class="strength-buttons">
                            <button class="strength-btn" disabled>‚àí</button>
                            <div class="strength-value" id="courseStrength">0</div>
                            <button class="strength-btn" disabled>+</button>
                        </div>
                    </div>

                    <!-- Panel Size (USER CONTROLLED) -->
                    <div class="strength-control" style="margin-top:16px">
                        <div class="strength-label">
                            <div style="font-size:16px;font-weight:700;margin-bottom:4px;">
                                Panel Size
                            </div>
                            <div style="font-size:13px;color:#6b7280">
                                Total officers to nominate (including buffer)
                            </div>
                        </div>

                        <div class="strength-buttons">
                            <button class="strength-btn" id="decreasePanel">‚àí</button>
                            <div class="strength-value" id="panelSize">0</div>
                            <button class="strength-btn" id="increasePanel">+</button>
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>üí° Logic:</strong>
                        <p id="logicText">
                            Panel size = Course strength + Buffer (10)
                        </p>
                    </div>
                </div>


                <!-- Step 3: Apply Filters -->
                <div class="section-card step-section" id="step-3">
                    <div class="section-title">
                        <span>üîç Step 3: Apply Filters & Select Officers</span>
                        <span class="badge badge-info">Active</span>
                    </div>
                    <div class="section-card">
                        <div class="section-title">
                            <span>üéØ Filters</span>
                        </div>

                        <div class="filter-grid">

                            <!-- Medical Category -->
                            <div class="form-group">
                                <label class="form-label">Medical Category</label>
                                <select class="form-select" id="medical">
                                    <option>All</option>
                                    <option value="S1">S1</option>
                                    <option value="H2">H2</option>
                                    <option value="A3">A3</option>
                                    <option value="P4">P4</option>
                                    <option value="E5">E5</option>
                                </select>
                            </div>

                            <!-- Course -->
                            <div class="form-group">
                                <label class="form-label">Course</label>
                                <input class="form-input" name="course" placeholder="Put course name" value="" />
                            </div>

                            <!-- Course Date -->
                            <div class="form-group">
                                <label class="form-label">Course Date</label>
                                <select class="form-select" id="courseDate">
                                    <option>All</option>
                                    <option value="Last 1 Month">Last 1 Month</option>
                                    <option value="Last 3 Months">Last 3 Months</option>
                                    <option value="Last 1 Year">Last 1 Year</option>
                                </select>
                            </div>

                            <!-- Course Grading -->
                            <div class="form-group">
                                <label class="form-label">Course Grading</label>
                                <select class="form-select" id="grading">
                                    <option>All</option>
                                    <option value="A+">A+</option>
                                    <option value="A">A</option>
                                    <option value="A-">A-</option>
                                    <option value="B">B+</option>
                                    <option value="B">B</option>
                                    <option value="B-">B-</option>
                                    <option value="C+">C+</option>
                                    <option value="C">C</option>

                                </select>
                            </div>

                            <!-- Posting Due -->
                            <div class="form-group">
                                <label class="form-label">Posting Due (Months)</label>
                                <div class="filter-options">
                                    <label><input type="checkbox"> 1</label>
                                    <label><input type="checkbox"> 2</label>
                                    <label><input type="checkbox"> 3</label>
                                </div>
                            </div>

                            <!-- Command -->
                            <div class="form-group">
                                <label class="form-label">Command</label>
                                <div class="filter-options">
                                    <label><input type="checkbox"> Western</label>
                                    <label><input type="checkbox"> Eastern</label>
                                    <label><input type="checkbox"> Southern</label>
                                    <label><input type="checkbox"> Northern</label>
                                </div>
                            </div>

                            <!-- Corps -->
                            <div class="form-group">
                                <label class="form-label">Corps</label>
                                <div class="filter-options">
                                    <label><input type="checkbox"> 1 Corps</label>
                                    <label><input type="checkbox"> 2 Corps</label>
                                    <label><input type="checkbox"> 3 Corps</label>
                                </div>
                            </div>

                            <!-- Units -->
                            <div class="form-group">
                                <label class="form-label">Units</label>
                                <div class="filter-options">
                                    <label><input type="checkbox"> 2 RAJPUT</label>
                                    <label><input type="checkbox"> 1 PARA SF</label>
                                    <label><input type="checkbox"> 3 GRENADIERS</label>

                                </div>
                            </div>

                            <!-- Civil Qualification -->
                            <div class="form-group">
                                <label class="form-label">Civil Qualification</label>
                                <input class="form-input" name="qualification" placeholder="Qualification" value="" />
                            </div>

                            <!-- Rank -->
                            <div class="form-group">
                                <label class="form-label">Rank</label>
                                <div class="filter-options">
                                    <label><input type="checkbox"> Major</label>
                                    <label><input type="checkbox"> General</label>
                                    <label><input type="checkbox"> Colonel</label>
                                    <label><input type="checkbox"> Captain</label>

                                </div>
                            </div>

                            <!-- Batch Year -->
                            <div class="form-group">
                                <label class="form-label">Batch Year</label>
                                <div class="filter-options">
                                    <label><input type="checkbox"> 2024</label>
                                    <label><input type="checkbox"> 2025</label>
                                    <label><input type="checkbox"> 2026</label>
                                </div>
                            </div>

                            <div class="form-group">
                                &nbsp;
                            </div>

                            <!-- Date of Commission -->
                            <div class="form-group">
                                <label class="form-label">Date of Commission From</label>
                                <input type="date" name="commissionFrom" class="form-input" />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Date of Commission To</label>
                                <input type="date" name="commissionTo" class="form-input" />
                            </div>

                            <!-- Date of Seniority From -->
                            <div class="form-group">
                                <label class="form-label">Date of Seniority From</label>
                                <input type="date" name="seniorityFrom" class="form-input" />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Date of Seniority To</label>
                                <input type="date" name="seniorityTo" class="form-input" />
                            </div>

                            <!-- Date of Birth From -->
                            <div class="form-group">
                                <label class="form-label">Date of Birth From</label>
                                <input type="date" name="dobFrom" class="form-input" />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Date of Birth To</label>
                                <input type="date" name="dobTo" class="form-input" />
                            </div>

                            <!-- Apply Button -->
                            <div class="filter-actions">
                                <button class="btn btn-primary" id="applyFiltersBtn">
                                    Apply Filters
                                </button>
                            </div>

                        </div>
                    </div>


                    <!-- Panel Summary -->
                    <div class="summary-box">
                        <div style="font-size: 18px; font-weight: 700; color: #065f46; text-align: center;">
                            Panel Summary
                        </div>

                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-value" id="panelTotalNominated">0</div>
                                <div class="summary-label">Total Nominated</div>
                            </div>

                            <div class="summary-item">
                                <div class="summary-value" id="panelCourseSeats">0</div>
                                <div class="summary-label">Course Seats</div>
                            </div>

                            <div class="summary-item">
                                <div class="summary-value" id="panelBufferSeats">0</div>
                                <div class="summary-label">Buffer Officers</div>
                            </div>

                            <div class="summary-item">
                                <div class="summary-value" id="panelAttendingCount">0</div>
                                <div class="summary-label">Attending</div>
                            </div>
                        </div>
                    </div>

                    <!-- Officers Table -->
                    <div style="margin-top: 24px">
                        <div
                                style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      "
                        >
                            <div style="font-size: 14px; font-weight: 600">
                                Selected Officers
                                (<span id="selectedCount">0</span> of
                                <span id="totalEligible">0</span> eligible)
                            </div>

                            <div style="display: flex; gap: 8px">
                                <button class="footer-btn success" id="saveToDraft">Save Draft</button>
                                <button class="btn btn-secondary" id="selectAllBtn" style="padding: 8px 16px">
                                    Select All
                                </button>
                                <button class="btn btn-secondary" id="deselectAllBtn" style="padding: 8px 16px">
                                    Deselect All
                                </button>
                            </div>
                        </div>

                        <div
                                style="
								background: white;
								border: 1px solid #e5e7eb;
								border-radius: 12px;
								overflow: hidden;
							  "
                        >
                            <div class="table-scroll-wrapper">
                                <table class="data-table">
                                    <thead>
                                    <tr>
                                        <th>‚úì</th>
                                        <th>Ser No</th>
                                        <th>Officer</th>
                                        <th>Rank</th>
                                        <th>Unit</th>
                                        <th>Command</th>
                                        <th>Date of Commission</th>
                                        <th>Date of Seniority</th>
                                        <th>Date of Birth</th>
                                        <th>Religion</th>
                                        <th>Marital Status</th>
                                        <th>Medical Category</th>

                                        <th>Mobile</th>
                                        <th>Email</th>
                                        <th>City</th>
                                        <th>State</th>
                                        <th>Attendance Status</th>
                                    </tr>
                                    </thead>

                                    <!-- JS WILL POPULATE ROWS -->
                                    <tbody id="officerTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Step 4: Review & Approve -->
                <!-- Step 4: Review & Approve -->
                <div class="section-card step-section" id="step-4">
                    <div class="section-title">
                        <span>üîç Step 4: Review & Approve</span>
                        <span class="badge badge-info">Active</span>
                    </div>

                    <!-- Officers Review Table -->
                    <div style="margin-top: 24px">
                        <div style="background: white;
							border: 1px solid #e5e7eb;
							border-radius: 12px;
							overflow: hidden;
						  ">
                            <div class="table-scroll-wrapper">
                                <table class="data-table">
                                    <thead>
                                    <tr>
                                        <thead>
                                    <tr>
                                        <th>Ser No</th>
                                        <th>Officer</th>
                                        <th>Rank</th>
                                        <th>Unit</th>
                                        <th>Command</th>
                                        <th>Date of Commission</th>
                                        <th>Date of Seniority</th>
                                        <th>Date of Birth</th>
                                        <th>Religion</th>
                                        <th>Marital Status</th>
                                        <th>Medical Category</th>
                                        <th>Mobile</th>
                                        <th>Email</th>
                                        <th>City</th>
                                        <th>State</th>
                                    </tr>
                                    </thead>

                                    </tr>
                                    </thead>

                                    <!-- JS WILL POPULATE FINAL APPROVAL LIST -->
                                    <tbody id="finalApprovalTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 25px">
                        <div class="section-title">
                            <span>üîç Send Panel</span>
                        </div>
                        <div class="filter-grid">
                            <div style="margin-top: 24px">
                                <div class="form-group">
                                    <label class="form-label">Send To</label>
                                    <select class="form-select" id="sendToRole">
                                        <option value="">-- Select Role --</option>
                                    </select>
                                </div>

                                <!-- Course -->
                                <div class="form-group"></div>
                                <div class="form-group"></div>
                                <div class="form-group"></div>

                                <div class="form-group">
                                    <label class="form-label">Remarks</label>
                                    <textarea
                                            name="remarks"
                                            rows="3"
                                            class="form-textarea"
                                            id="approvalRemark"
                                            placeholder="Panel forwarded for approval"
                                    ></textarea>                                </div>
                                <div style="margin-top: 24px">
                                    <button class="footer-btn success" id="sendToApproval">
                                        Send for Approval
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Generate Letter -->
                <div class="section-card step-section" id="step-5">
                    <div class="section-title">
                        <span>üîç Step 5: Generate Letter</span>
                        <span class="badge badge-info">Active</span>
                    </div>

                    <!-- Officers Selection Table -->
                    <div style="margin-top: 24px">
                        <div
                                style="
								background: white;
								border: 1px solid #e5e7eb;
								border-radius: 12px;
								overflow: hidden;"
                        >
                            <div class="table-scroll-wrapper">
                                <table class="data-table">

                                    <thead>
                                    <tr>
                                        <thead>
                                    <tr>
                                        <th>Ser No</th>
                                        <th>Officer</th>
                                        <th>Rank</th>
                                        <th>Unit</th>
                                        <th>Command</th>
                                        <th>Date of Commission</th>
                                        <th>Date of Seniority</th>
                                        <th>Date of Birth</th>
                                        <th>Mobile</th>
                                        <th>Email</th>
                                        <th>City</th>
                                        <th>State</th>
                                        <th>Letter</th>
                                    </tr>
                                    </thead>

                                    </tr>
                                    </thead>
                                    <tbody>


                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Action Buttons -->
                <!-- Footer Navigation -->
                <div class="footer-nav">
                    <!-- LEFT -->
                    <div class="footer-left">
                        <div class="step-nav-btn" id="prevNav">
                            <div class="step-number">‚Üê</div>
                            <div>
                                <div class="step-label">Previous</div>
                                <div class="step-desc">Go back</div>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT -->
                    <div class="footer-right">
                        <!--                        <button class="footer-btn secondary" id="saveToDraft">Save Draft</button>-->
                        <!--                        <button class="footer-btn success">Send for Approval</button>-->

                        <div class="step-nav-btn" id="nextNav">
                            <div class="step-number">‚Üí</div>
                            <div>
                                <div class="step-label">Next</div>
                                <div class="step-desc">Continue</div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </main>
</div>
<script>
    const TOTAL_STEPS = 5;
    let currentStep = 1;

    /* ===============================
               GLOBAL STATE (DECLARE FIRST!)
            ================================ */
            let officers = [];
            let attendingSet = new Set();
            const selectedSet = new Set(); // checkbox only
            let nominatedSet = new Set();

    const prevNav = document.getElementById('prevNav');
    const nextNav = document.getElementById('nextNav');
	const saveToDraft = document.getElementById('saveToDraft');
    const steps = document.querySelectorAll('.step');
    const sections = document.querySelectorAll('.step-section');

    function renderStep() {
      // Show content
      sections.forEach(s => s.classList.remove('active'));
      document.getElementById(`step-${currentStep}`).classList.add('active');

      // Top indicator
      steps.forEach((step, index) => {
        const num = index + 1;
        const circle = step.querySelector('.step-number');

        step.classList.remove('active', 'completed');

        if (num < currentStep) {
          step.classList.add('completed');
          circle.textContent = '‚úì';
        } else if (num === currentStep) {
          step.classList.add('active');
          circle.textContent = num;
        } else {
          circle.textContent = num;
        }
      });

      // Bottom nav state
      prevNav.classList.toggle('disabled', currentStep === 1);
      nextNav.classList.toggle('disabled', currentStep === TOTAL_STEPS);

      // LOAD STEP-4 DATA WHEN STEP-4 OPENS
if (currentStep === 4) {
  loadStep4Panel();
}

if (currentStep === 5) {
  loadStep5Panel();
}
      prevNav.classList.toggle('active', currentStep > 1);
      nextNav.classList.toggle('active', currentStep < TOTAL_STEPS);
    }

    // Bottom navigation
    nextNav.addEventListener('click', () => {

  /* ===============================
     NORMAL NEXT
  ================================ */
  if (currentStep < TOTAL_STEPS) {
    currentStep++;
    renderStep();
  }
});

saveToDraft.addEventListener('click', () => {
  if (currentStep === 3) {
    handleStep3Save();
  }
});

function handleStep3Save() {
  const scheduleId = sessionStorage.getItem("scheduleId");

  if (!scheduleId) {
    alert("Please select a course schedule first.");
    return;
  }

  // IF NOTHING SELECTED ‚Üí JUST MOVE ON
  if (selectedSet.size === 0) {
    console.log("No officers selected. Skipping save.");

    currentStep++;
    renderStep();
    return;
  }

  // BUILD PAYLOAD
  const nominations = Array.from(selectedSet).map(personnelId => ({
    personnelId,
    status: attendingSet.has(personnelId)
      ? "ATTENDING"
      : "ATTENDING"
  }));

  const payload = {
    scheduleId: parseInt(scheduleId),
    nominations
  };

  console.log("SAVING PANEL:", payload);

  fetch("http://localhost:6060/api/course-panel/nomination", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
    .then(res => {
      if (!res.ok) throw new Error("Failed to save panel");

      alert("Panel saved successfully");
      renderStep();
    })
    .catch(err => {
      console.error(err);
      alert("Personnel Already Exists");
    });
}


    // Top step click
    steps.forEach((step, index) => {
      step.addEventListener('click', () => {
        currentStep = index + 1;
        renderStep();
      });
    });

    document.addEventListener("DOMContentLoaded", () => {

        const courseSelect = document.getElementById("courseSelect");
        const startDateInput = document.getElementById("courseStartDate");
        const endDateInput = document.getElementById("courseEndDate");

        fetch("http://localhost:6060/api/courseschedule/step1")
        .then(res => res.json())
        .then(courses => {

        courseSelect.innerHTML = `<option value="">-- Select Course --</option>`;

        courses.forEach(course => {
    const option = document.createElement("option");

    //  scheduleId is PRIMARY now
    option.value = course.scheduleId;

    option.textContent =
        `${course.courseName} (${course.startDate} ‚Üí ${course.endDate})`;

    option.dataset.courseId = course.courseId;
    option.dataset.startDate = course.startDate;
    option.dataset.endDate = course.endDate;

    courseSelect.appendChild(option);
});

    });

        // THIS IS THE FIX
        courseSelect.addEventListener("change", function () {

    const selectedOption = this.options[this.selectedIndex];

    const scheduleId = this.value;
    const courseId   = selectedOption.dataset.courseId;

    if (!scheduleId) {
        sessionStorage.clear();
        return;
    }

    // STORE scheduleId for Step-3 save
    sessionStorage.setItem("scheduleId", scheduleId);

    // keep existing logic
    document.getElementById("courseStartDate").value =
        selectedOption.dataset.startDate;

    document.getElementById("courseEndDate").value =
        selectedOption.dataset.endDate;

    // STEP-2 API still needs courseId
    loadStep2PanelStrength(courseId);
});
    });



  //step-2

    let courseStrength = 0;
        let panelSize = 0;
        const BUFFER = 10;

        const courseStrengthEl = document.getElementById("courseStrength");
        const panelSizeEl = document.getElementById("panelSize");
        const plusBtn = document.getElementById("increasePanel");
        const minusBtn = document.getElementById("decreasePanel");
        const logicText = document.getElementById("logicText");
    function loadStep2PanelStrength(courseId) {

        if (!courseId) {
            console.warn("Course ID missing");
            return;
        }

        fetch(`http://localhost:6060/api/courseschedule/step2/${courseId}`)
            .then(res => res.json())
            .then(data => {

                courseStrength = parseInt(data.courseStrength);
                panelSize = parseInt(data.panelSize);

                courseStrengthEl.innerText = courseStrength;
                panelSizeEl.innerText = panelSize;

                logicText.innerText =
                    `Panel size (${panelSize}) = Course strength (${courseStrength}) + Buffer (10).`;

                /* ===============================
                   STORE FOR STEP-3
                ================================ */
                sessionStorage.setItem("courseStrength", courseStrength);
                sessionStorage.setItem("panelSize", panelSize);
                sessionStorage.setItem("bufferSize", panelSize - courseStrength);


                console.log(
                    "STEP2 STORED =>",
                    sessionStorage.getItem("courseStrength"),
                    sessionStorage.getItem("panelSize"),
                    sessionStorage.getItem("bufferSize")
                );
            })
            .catch(err => {
                console.error(err);
                logicText.innerText = "Unable to load course strength";
            });
    }


     // ‚ûï Increase panel size
    plusBtn.addEventListener("click", () => {
        panelSize++;
        panelSizeEl.innerText = panelSize;

        sessionStorage.setItem("panelSize", panelSize);
        sessionStorage.setItem("bufferSize", panelSize - courseStrength);
    });

    minusBtn.addEventListener("click", () => {
        if (panelSize > courseStrength) {
            panelSize--;
            panelSizeEl.innerText = panelSize;

            sessionStorage.setItem("panelSize", panelSize);
            sessionStorage.setItem("bufferSize", panelSize - courseStrength);
        }
    });



        document.addEventListener("DOMContentLoaded", function () {
            /* ===============================
               PANEL SUMMARY INIT
            ================================ */
            const panelTotal = document.getElementById("panelTotalNominated");
            const panelCourse = document.getElementById("panelCourseSeats");
            const panelBuffer = document.getElementById("panelBufferSeats");
            const panelAttend = document.getElementById("panelAttendingCount");
            const selectedCountEl      = document.getElementById("selectedCount");
            const totalEligibleEl      = document.getElementById("totalEligible");

            const panelSize = sessionStorage.getItem("panelSize");
            const courseStrength = sessionStorage.getItem("courseStrength");
            const bufferSize = sessionStorage.getItem("bufferSize");

            console.log("STEP3 FETCHED =>", panelSize, courseStrength, bufferSize);

            if (panelTotal) panelTotal.innerText = panelSize || "0";
            if (panelCourse) panelCourse.innerText = courseStrength || "0";
            if (panelBuffer) panelBuffer.innerText = bufferSize || "0";
            if (panelAttend) panelAttend.innerText = "0";

            /* ===============================
               ATTENDING COUNT
            ================================ */
            function updateAttendingCount() {
                const panelAttend = document.getElementById("panelAttendingCount");
                if (panelAttend) {
                    panelAttend.innerText = attendingSet.size;
                }
            }

            // safe call AFTER init
            updateAttendingCount();

            function el(id) {
                return document.getElementById(id);
            }


        // /* ===============================
        //    INITIAL LOAD
        // ================================ */
        // loadOfficers();
            function loadOfficers() {
                fetch("http://localhost:6060/api/panel/officers")
                    .then(res => res.json())
                    .then(data => {
                        officers = Array.isArray(data) ? data : [];
                        el("totalEligible").innerText = officers.length;
                        renderOfficerTable();
                    })
                    .catch(err => console.error("Officer load error", err));
            }

            /* ===============================
               RENDER TABLE
            ================================ */
			function renderOfficerTable() {
  const tbody = document.getElementById("officerTableBody");
  if (!tbody) return;

  tbody.innerHTML = "";

  officers.forEach((o, index) => {

    const isSelected  = selectedSet.has(o.personnelId);
    const isAttending = attendingSet.has(o.personnelId);

    const row = document.createElement("tr");

    /* ‚úÖ DATA ATTRIBUTES ‚Äî MUST BE HERE */
    row.dataset.medical = (o.medicalCategory || "").toUpperCase();
    row.dataset.rank = (o.rank || "").toUpperCase();
    row.dataset.unit = (o.unitName || "").toUpperCase();
    row.dataset.command = (o.command || "").toUpperCase();
    row.dataset.city = (o.city || "").toUpperCase();
    row.dataset.state = (o.state || "").toUpperCase();

    row.innerHTML = `
      <td><input type="checkbox" ${isSelected ? "checked" : ""}></td>
      <td>${index + 1}</td>
      <td>
        <div style="display:flex;align-items:center;gap:10px">
          <img src="http://localhost:6060/${o.officerImage || 'uploads/default.png'}"
               style="width:36px;height:36px;border-radius:50%;object-fit:cover" />
          <div>
            <div style="font-weight:600">${o.fullName}</div>
            <div style="font-size:12px;color:#6b7280">${o.armyNo}</div>
          </div>
        </div>
      </td>
      <td>${o.rank || "-"}</td>
      <td>${o.unitName || "-"}</td>
      <td>${o.command || "-"}</td>
      <td>${formatDate(o.dateOfCommission)}</td>
      <td>${formatDate(o.dateOfSeniority)}</td>
      <td>${formatDate(o.dateOfBirth)}</td>
      <td>${o.religion || "-"}</td>
      <td>${o.maritalStatus || "-"}</td>
      <td>${o.medicalCategory || "-"}</td>
      <td>${o.mobileNumber || "-"}</td>
      <td>${o.emailAddress || "-"}</td>
      <td>${o.city || "-"}</td>
      <td>${o.state || "-"}</td>
      <td>
        <button class="btn ${isAttending ? "btn-success" : "btn-outline"}">
          ‚úì Attending
        </button>
        <button class="btn ${!isAttending ? "btn-danger" : "btn-outline"}">
          ‚úó Not Attending
        </button>
      </td>
    `;

    /* checkbox */
    row.querySelector("input").addEventListener("change", e => {
      e.target.checked
        ? selectedSet.add(o.personnelId)
        : selectedSet.delete(o.personnelId);

      el("selectedCount").innerText = selectedSet.size;
    });

    /* attending */
    row.querySelector(".btn-success, .btn-outline")
      .addEventListener("click", () => {
        markAttending(o.personnelId, true);
      });

    /* not attending */
    row.querySelector(".btn-danger, .btn-outline:last-child")
      .addEventListener("click", () => {
        markAttending(o.personnelId, false);
      });

    tbody.appendChild(row);
  });
}

            /* ===============================
               ATTENDANCE HANDLER
            ================================ */
<!--            function markAttending(personnelId, attending) {-->
<!--                attending-->
<!--                    ? attendingSet.add(personnelId)-->
<!--                    : attendingSet.delete(personnelId);-->

<!--                updateAttendingCount();-->
<!--                renderOfficerTable();-->
<!--            }-->

    function markAttending(personnelId, isAttending) {

  if (isAttending) {
    attendingSet.add(personnelId);
  } else {
    attendingSet.delete(personnelId);
  }

<!--  updateSummaryCounts(); // optional-->
}

            /* ===============================
               PANEL SUMMARY
            ================================ */
            function updateAttendingCount() {
                if (el("panelAttendingCount")) {
                    el("panelAttendingCount").innerText = attendingSet.size;
                }
            }

            /* ===============================
               SAVE ATTENDANCE (BULK)
            ================================ */
            function saveAttendanceBulk() {
                const payload = Array.from(attendingSet).map(id => ({
                    personnelId: id,
                    status: "ATTENDING"
                }));

                fetch("http://localhost:6060/api/panel/attendance/bulk", {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
            }

            /* ===============================
               SELECT / DESELECT ALL
            ================================ */
            el("selectAllBtn")?.addEventListener("click", () => {
                officers.forEach(o => selectedSet.add(o.personnelId));
                el("selectedCount").innerText = selectedSet.size;
                renderOfficerTable();
            });

            el("deselectAllBtn")?.addEventListener("click", () => {
                selectedSet.clear();
                el("selectedCount").innerText = 0;
                renderOfficerTable();
            });

            /* ===============================
               STEP-4
            ================================ */
            el("sendForApprovalBtn")?.addEventListener("click", () => {
                saveAttendanceBulk();
                loadStep4();
                el("step-3").style.display = "none";
                el("step-4").style.display = "block";
            });

            function loadStep4() {
                fetch("http://localhost:6060/api/panel/attendance/all")
                    .then(res => res.json())
                    .then(data => {
                        const tbody = el("finalApprovalTableBody");
                        if (!tbody) return;

                        tbody.innerHTML = "";
                        data.forEach((o, index) => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
              <td>${index + 1}</td>
              <td>${o.fullName}</td>
              <td>${o.armyNo}</td>
              <td>${o.rank}</td>
              <td>${o.unitName}</td>
              <td>${o.command}</td>
              <td>${o.dateOfSeniority ?? ""}</td>
            `;
                            tbody.appendChild(row);
                        });
                    });
            }

            /* ===============================
               INIT
            ================================ */
            loadOfficers();


    });

    /* ===============================
   STEP-4 HELPERS (GLOBAL)
================================ */

function loadStep4Panel() {
  const scheduleId = sessionStorage.getItem("scheduleId");

  if (!scheduleId) return;

  fetch(`http://localhost:6060/api/course-panel/nomination/${scheduleId}`)
    .then(res => res.json())
    .then(panelData => {

      const personnelIds = panelData
        .filter(p => p.attendanceStatus === "ATTENDING")
        .map(p => p.personnelId);

      if (personnelIds.length === 0) {
        renderEmptyStep4();
        return;
      }

      fetch("http://localhost:6060/api/panel/officers")
        .then(res => res.json())
        .then(allOfficers => {

          const finalList = allOfficers.filter(o =>
            personnelIds.includes(o.personnelId)
          );

          renderStep4Table(finalList); // ‚úÖ now renders FULL columns
        });
    })
    .catch(err => console.error("Step-4 error", err));
}

function loadStep5Panel() {

  const scheduleId = sessionStorage.getItem("scheduleId");
  if (!scheduleId) return;

  fetch(`http://localhost:6060/api/course-panel/nomination/${scheduleId}`)
    .then(res => res.json())
    .then(panelData => {

      const personnelIds = panelData
        .filter(p => p.attendanceStatus === "ATTENDING")
        .map(p => p.personnelId);

      if (personnelIds.length === 0) {
        renderEmptyStep5();
        return;
      }

      fetch("http://localhost:6060/api/panel/officers")
        .then(res => res.json())
        .then(allOfficers => {

          const finalList = allOfficers.filter(o =>
            personnelIds.includes(o.personnelId)
          );

          renderStep5Table(finalList);
        });
    })
    .catch(err => console.error("Step-5 error", err));
}

function renderEmptyStep5() {
  const tbody = document.querySelector("#step-5 tbody");
  if (!tbody) return;

  tbody.innerHTML = `
    <tr>
      <td colspan="17" style="text-align:center;color:#6b7280;padding:20px;">
        No officers available for letter generation
      </td>
    </tr>
  `;
}


function renderStep4Table(officers) {

  const tbody = document.getElementById("finalApprovalTableBody");
  if (!tbody) return;

  tbody.innerHTML = "";

  if (!Array.isArray(officers) || officers.length === 0) {
    renderEmptyStep4();
    return;
  }

  officers.forEach((o, index) => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${index + 1}</td>

      <td>
        <div style="display:flex;align-items:center;gap:10px">
          <img
            src="http://localhost:6060/${o.officerImage || 'uploads/default.png'}"
            style="width:36px;height:36px;border-radius:50%;object-fit:cover"
          />
          <div>
            <div style="font-weight:600">${o.fullName}</div>
            <div style="font-size:12px;color:#6b7280">${o.armyNo}</div>
          </div>
        </div>
      </td>

      <td>${o.rank || "-"}</td>
      <td>${o.unitName || "-"}</td>
      <td>${o.command || "-"}</td>
      <td>${formatDate(o.dateOfCommission)}</td>
      <td>${formatDate(o.dateOfSeniority)}</td>
      <td>${formatDate(o.dateOfBirth)}</td>
      <td>${o.religion || "-"}</td>
      <td>${o.maritalStatus || "-"}</td>
      <td>${o.medicalCategory || "-"}</td>
      <td>${o.mobileNumber || "-"}</td>
      <td>${o.emailAddress || "-"}</td>
      <td>${o.city || "-"}</td>
      <td>${o.state || "-"}</td>
    `;

    tbody.appendChild(row);
  });
}

function renderEmptyStep4() {
  const tbody = document.getElementById("finalApprovalTableBody");
  tbody.innerHTML = `
    <tr>
      <td colspan="7" style="text-align:center;color:#6b7280;padding:20px;">
        No officers nominated for this schedule
      </td>
    </tr>
  `;
}


function renderStep5Table(officers) {

  const tbody = document.querySelector("#step-5 tbody");
  if (!tbody) return;

  tbody.innerHTML = "";

  if (!Array.isArray(officers) || officers.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="17" style="text-align:center;color:#6b7280;padding:20px;">
          No officers available for letter generation
        </td>
      </tr>
    `;
    return;
  }

  officers.forEach((o, index) => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${index + 1}</td>

      <td>
        <div style="display:flex;align-items:center;gap:10px">
          <img
            src="http://localhost:6060/${o.officerImage || 'uploads/default.png'}"
            style="width:36px;height:36px;border-radius:50%;object-fit:cover"
          />
          <div>
            <div style="font-weight:600">${o.fullName}</div>
            <div style="font-size:12px;color:#6b7280">${o.armyNo}</div>
          </div>
        </div>
      </td>

      <td>${o.rank || "-"}</td>
      <td>${o.unitName || "-"}</td>
      <td>${o.command || "-"}</td>
      <td>${formatDate(o.dateOfCommission)}</td>
      <td>${formatDate(o.dateOfSeniority)}</td>
      <td>${formatDate(o.dateOfBirth)}</td>
      <td>${o.mobileNumber || "-"}</td>
      <td>${o.emailAddress || "-"}</td>
      <td>${o.city || "-"}</td>
      <td>${o.state || "-"}</td>

      <td>
        <button class="attendance-btn attending">
          ‚úì Generate Letter
        </button>
      </td>
    `;

    tbody.appendChild(row);
  });
}

function formatDate(dateStr) {
  if (!dateStr) return "-";
  const d = new Date(dateStr);
  return d.toLocaleDateString("en-GB");
}
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      loadSendToRoles();
    });

    function loadSendToRoles() {
      const select = document.getElementById("sendToRole");
      if (!select) return;

      fetch("http://localhost:6060/api/roles/summary")
        .then(res => res.json())
        .then(data => {

          // Safety check
          if (!Array.isArray(data)) return;

          data.forEach(role => {
            const option = document.createElement("option");
            option.value = role.roleId;          // üî• value = roleId
            option.textContent = role.roleName;  // üî• label = roleName
            select.appendChild(option);
          });
        })
        .catch(err => {
          console.error("Failed to load roles", err);
        });
    }

        document.getElementById("sendToApproval")?.addEventListener("click", () => {

      const scheduleId = sessionStorage.getItem("scheduleId");
      const roleId = document.getElementById("sendToRole")?.value;
      const remark = document.getElementById("approvalRemark")?.value || "";

      /* ===============================
         BASIC VALIDATION
      ================================ */
      if (!scheduleId) {
        alert("Schedule ID missing. Please select course first.");
        return;
      }

      if (!roleId) {
        alert("Please select a role to send approval.");
        return;
      }

      /* ===============================
         BUILD PAYLOAD
      ================================ */
      const payload = {
        scheduleId: parseInt(scheduleId),
        roleId: parseInt(roleId),
        status: "pending",
        remark: remark.trim()
      };

      console.log("Sending for approval:", payload);

      /* ===============================
         API CALL
      ================================ */
      fetch("http://localhost:6060/api/course-schedule-role-status", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
        .then(res => {
          if (!res.ok) {
            throw new Error("Failed to send for approval");
          }
          return res.json();
        })
        .then(data => {
          console.log("Approval sent successfully", data);
          alert("Panel sent for approval successfully.");
        })
        .catch(err => {
          console.error(err);
          alert("Error while sending for approval.");
        });

    });


document
  .getElementById("applyFiltersBtn")
  .addEventListener("click", applyFilters);

function applyFilters() {

  const medical = document.getElementById("medical").value.toUpperCase();
  const grading = document.getElementById("grading").value.toUpperCase();

  const selectedCommands = getCheckedValues("Command");
  const selectedRanks = getCheckedValues("Rank");
  const selectedUnits = getCheckedValues("Units");

  const rows = document.querySelectorAll("#officerTableBody tr");

  rows.forEach(row => {
    let visible = true;

    if (medical !== "ALL" && row.dataset.medical !== medical)
      visible = false;

    if (selectedCommands.length &&
        !selectedCommands.includes(row.dataset.command))
      visible = false;

    if (selectedRanks.length &&
        !selectedRanks.includes(row.dataset.rank))
      visible = false;

    if (selectedUnits.length &&
        !selectedUnits.includes(row.dataset.unit))
      visible = false;

    row.style.display = visible ? "" : "none";
  });

  updateEligibleCount();
}

	function getCheckedValues(labelText) {
  const group = [...document.querySelectorAll(".form-group")]
    .find(g => g.querySelector(".form-label")?.innerText === labelText);

  if (!group) return [];

  return [...group.querySelectorAll("input[type='checkbox']:checked")]
    .map(cb => cb.parentElement.innerText.trim().toUpperCase());
}

		  function updateEligibleCount() {
  const rows = [...document.querySelectorAll("#officerTableBody tr")];
  const visibleRows = rows.filter(r => r.style.display !== "none");

  document.getElementById("totalEligible").innerText = visibleRows.length;
}

</script>

</body>
</html>

